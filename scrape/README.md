# AllSides News Scraper and Political Bias Classifier

This project scrapes news articles from AllSides.com, extracts their full text, and classifies their political leaning using AI. It maintains a dataset of articles that grows over time as you collect more data.

## Files and Their Purpose

- **mergedTest.py**: Main script for scraping articles from AllSides, extracting their full text, and managing the dataset.
- **political_leaning_classifier.py**: Script for classifying articles' political leanings using the DeepSeek API.
- **article_retriever.py**: (Optional) Helper script for retrieving article text using multiple methods.

## Requirements

- Python 3.7+
- Required packages: pandas, tqdm, openai, BeautifulSoup, newspaper3k, requests, cloudscraper

Install the required packages using pip:
```bash
pip install pandas tqdm openai beautifulsoup4 newspaper3k requests cloudscraper
```

## Basic Usage

### Scraping New Articles

To scrape new articles from AllSides without classification:
```bash
python mergedTest.py
```

This will:
1. Retrieve articles from AllSides
2. Extract their full text
3. Add them to your existing dataset (if any)
4. Save the results in both JSON and CSV formats

### Scraping Articles with Classification

To scrape new articles and classify them:
```bash
python mergedTest.py --classify
```

This will perform all the steps above, plus classify the political leaning of new articles using the DeepSeek API.

### Scraping Articles and Classifying All Articles (Including Existing Ones)

```bash
python mergedTest.py --classify-all
```

This will scrape new articles, classify them, and also re-evaluate the political leaning of all existing articles.

### Skipping Text Re-extraction for Problematic Articles

To avoid re-trying text extraction for articles that previously failed:
```bash
python mergedTest.py --classify --skip-text-extraction
```

### Running Only Classification 

If you want to classify articles without scraping new ones:
```bash
python political_leaning_classifier.py
```

## Command-Line Arguments

`mergedTest.py` accepts the following arguments:

- `--url`: URL to scrape (default: "https://www.allsides.com/unbiased-balanced-news")
- `--classify`: Flag to classify new articles for political leaning
- `--classify-all`: Flag to classify all articles (including existing ones)
- `--json-path`: Path to save/load JSON file (default: "allsides_articles.json")
- `--csv-path`: Path to save CSV file (default: "allsides_articles.csv")
- `--skip-text-extraction`: Skip attempting to extract missing text from existing articles

## Understanding the Classification Process

The political leaning classifier uses the DeepSeek API to analyze article content and determine its bias across five categories:
- Left
- Lean Left
- Center
- Lean Right
- Right

The system also compares the AI classification with AllSides' own source rating to see how often they match.

## How Article Processing Works

1. **Article Scraping**: Articles are scraped from AllSides, including metadata like title, source outlet, and source rating.
2. **Full Text Extraction**: The system attempts to extract the full text of each article using the original source URL.
3. **Deduplication**: The system checks for duplicates to prevent re-adding articles you've already scraped.
4. **Classification**: If enabled, the system uses the DeepSeek API to classify the political leaning of articles.
5. **Dataset Management**: All articles are saved in both JSON and CSV formats for easy analysis.

## Common Workflow

A typical workflow looks like:

1. Run an initial scrape to create your dataset:
   ```bash
   python mergedTest.py --classify
   ```

2. Periodically add new articles:
   ```bash
   python mergedTest.py --classify --skip-text-extraction
   ```

3. Occasionally re-classify all articles (if needed):
   ```bash
   python mergedTest.py --classify-all --skip-text-extraction
   ```

## Troubleshooting

- **API Rate Limits**: The DeepSeek API has rate limits. The script includes random delays to help avoid them.
- **Text Extraction Failures**: Some articles may be behind paywalls or have anti-scraping measures. The system will mark these as failed.
- **Import Errors**: Make sure all required packages are installed.

## Data Files

- **allsides_articles.json**: Main JSON file containing all article data.
- **allsides_articles.csv**: CSV version of the same data for easy import into analysis tools.
- **allsides_articles_classified.json**: (Generated by political_leaning_classifier.py) Same data with classification added.
- **allsides_articles_classified.csv**: CSV version of the classified data. 